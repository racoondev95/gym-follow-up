<h2 mat-dialog-title class="comparison-dialog-title">
  <mat-icon>compare_arrows</mat-icon>
  Compare Sessions
</h2>

<mat-dialog-content class="comparison-dialog-content">
  <div class="comparison-container" *ngIf="!loading">
    <!-- Left Side - Previous Session -->
    <div class="comparison-side">
      <div class="side-header">
        <h3>
          <mat-icon>history</mat-icon>
          Previous Session
        </h3>
      </div>
      
      <div class="search-section">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Search Sessions</mat-label>
          <input matInput [formControl]="leftSearchControl" placeholder="Search by name or date">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>
      </div>

      <div class="select-section">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Select Session</mat-label>
          <mat-select (selectionChange)="onLeftSessionSelected($event.value)">
            <mat-option *ngFor="let session of leftFilteredSessions | async" [value]="session">
              <div class="session-option">
                <span class="session-name">{{ session.name || 'Unnamed Session' }}</span>
                <span class="session-date">{{ formatSessionDate(session.sessionDate) }}</span>
              </div>
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>event</mat-icon>
        </mat-form-field>
      </div>

      <!-- Previous Session Details (same format as right side) -->
      <div class="session-details" *ngIf="leftSelectedSession">
        <div class="session-info">
          <h4>{{ leftSelectedSession.name || 'Unnamed Session' }}</h4>
          <span class="session-date">{{ formatSessionDate(leftSelectedSession.sessionDate) }}</span>
        </div>

        <div class="exercises-section">
          <h3 class="exercises-title">
            <mat-icon>fitness_center</mat-icon>
            Exercises
          </h3>

          <div class="exercises-list" *ngIf="leftSelectedSession.exercises && leftSelectedSession.exercises.length > 0">
            <div *ngFor="let exercise of leftSelectedSession.exercises" class="exercise-item">
              <div class="exercise-form-fields">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Exercise Name</mat-label>
                  <input matInput [value]="exercise.name" disabled>
                  <mat-icon matPrefix>fitness_center</mat-icon>
                </mat-form-field>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Number of Series</mat-label>
                    <input matInput type="number" [value]="exercise.numberOfSeries || ''" disabled>
                    <mat-icon matPrefix>list</mat-icon>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Range Reps Per Series</mat-label>
                    <input matInput [value]="exercise.rangeRepsPerSeries || ''" disabled>
                    <mat-icon matPrefix>repeat</mat-icon>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Weight on Last Series (kg)</mat-label>
                    <input matInput type="number" step="0.01" [value]="exercise.weightOnLastSeries || ''" disabled>
                    <mat-icon matPrefix>scale</mat-icon>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Reps on Last Series</mat-label>
                    <input matInput type="number" [value]="exercise.repsOnLastSeries || ''" disabled>
                    <mat-icon matPrefix>tag</mat-icon>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>

          <div class="no-exercises" *ngIf="!leftSelectedSession.exercises || leftSelectedSession.exercises.length === 0">
            <mat-icon>info</mat-icon>
            <p>No exercises in this session</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side - Current Session -->
    <div class="comparison-side">
      <div class="side-header">
        <h3>
          <mat-icon>today</mat-icon>
          Current Session
        </h3>
      </div>
      
      <div class="search-section">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Search Sessions</mat-label>
          <input matInput [formControl]="rightSearchControl" placeholder="Search by name or date">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>
      </div>

      <div class="select-section">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Select Session</mat-label>
          <mat-select (selectionChange)="onRightSessionSelected($event.value)">
            <mat-option *ngFor="let session of rightFilteredSessions | async" [value]="session">
              <div class="session-option">
                <span class="session-name">{{ session.name || 'Unnamed Session' }}</span>
                <span class="session-date">{{ formatSessionDate(session.sessionDate) }}</span>
              </div>
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>event</mat-icon>
        </mat-form-field>
      </div>

      <!-- Current Session Details (similar to edit dialog but disabled) -->
      <div class="session-details" *ngIf="rightSelectedSession">
        <div class="session-info">
          <h4>{{ rightSelectedSession.name || 'Unnamed Session' }}</h4>
          <span class="session-date">{{ formatSessionDate(rightSelectedSession.sessionDate) }}</span>
        </div>

        <div class="exercises-section">
          <h3 class="exercises-title">
            <mat-icon>fitness_center</mat-icon>
            Exercises
          </h3>

          <!-- Warning message when exercises cannot be compared -->
          <div class="comparison-warning" *ngIf="leftSelectedSession && rightSelectedSession && !hasComparableExercises && rightSelectedSession.exercises && rightSelectedSession.exercises.length > 0 && leftSelectedSession.exercises && leftSelectedSession.exercises.length > 0">
            <mat-icon>warning</mat-icon>
            <div class="warning-content">
              <strong>Cannot compare exercises</strong>
              <p>The selected sessions contain different exercises. Exercises are displayed but cannot be compared directly.</p>
            </div>
          </div>

          <div class="exercises-list" *ngIf="rightSelectedSession.exercises && rightSelectedSession.exercises.length > 0">
            <div *ngFor="let comparison of exerciseComparisons" class="exercise-item">
              <div class="exercise-form-fields">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Exercise Name</mat-label>
                  <input matInput [value]="comparison.exercise.name" disabled>
                  <mat-icon matPrefix>fitness_center</mat-icon>
                </mat-form-field>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Number of Series</mat-label>
                    <input matInput type="number" [value]="comparison.exercise.numberOfSeries || ''" disabled>
                    <mat-icon matPrefix>list</mat-icon>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Range Reps Per Series</mat-label>
                    <input matInput [value]="comparison.exercise.rangeRepsPerSeries || ''" disabled>
                    <mat-icon matPrefix>repeat</mat-icon>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Weight on Last Series (kg)</mat-label>
                    <input matInput type="number" step="0.01" [value]="comparison.exercise.weightOnLastSeries || ''" disabled>
                    <mat-icon matPrefix>scale</mat-icon>
                    <mat-hint class="weight-difference-hint" *ngIf="hasWeightDifference(comparison)" 
                              [class]="'weight-difference-hint ' + (isWeightIncrease(comparison) ? 'success' : 'error')">
                      <mat-icon>{{ isWeightIncrease(comparison) ? 'trending_up' : 'trending_down' }}</mat-icon>
                      {{ getWeightDifferenceText(comparison) }}
                    </mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Reps on Last Series</mat-label>
                    <input matInput type="number" [value]="comparison.exercise.repsOnLastSeries || ''" disabled>
                    <mat-icon matPrefix>tag</mat-icon>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>

          <div class="no-exercises" *ngIf="!rightSelectedSession.exercises || rightSelectedSession.exercises.length === 0">
            <mat-icon>info</mat-icon>
            <p>No exercises in this session</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading sessions...</p>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-stroked-button (click)="onClose()">
    <mat-icon>close</mat-icon>
    Close
  </button>
</mat-dialog-actions>

